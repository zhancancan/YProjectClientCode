#ifndef WATER_LIGHT_CG 
#define WATER_LIGHT_CG
 
 
	#include "UnityCG.cginc"
	#include "Lighting.cginc"
	#include "AutoLight.cginc" 
	#include "../Core/fog_tools.cginc"

	half4 _Specular;

	struct WaterColor{
		 float Gloss;  
		 float Specular;
		 float Alpha;
		 half3 Albedo;
		 half3 Emission;

		 half atten;


		 half3 normal; 
		 half3 viewDir; 
		 half3 lightDir;
		 half3 worldPos;
	};




	struct v2f {
		float4 pos: SV_POSITION; 
		float4 tSpace0:TEXCOORD0; 
		float4 tSpace1:TEXCOORD1; 
		float4 tSpace2:TEXCOORD2; 		 
		float4 proj0:TEXCOORD3; 
		float4 proj1:TEXCOORD4;

		UNITY_FOG_COORDS(5)  
	}; 


	inline v2f vertCacu(appdata_full v){
		v2f o; 
		UNITY_INITIALIZE_OUTPUT(v2f,o); 		

		o.pos = UnityObjectToClipPos(v.vertex);     
		
		float4 position  = UnityObjectToClipPos(v.vertex);
		o.proj0 = ComputeScreenPos(position);
		COMPUTE_EYEDEPTH(o.proj0.z);

		o.proj1 = o.proj0;
		#if UNITY_UV_STARTS_AT_TOP
			o.proj1.y = (position.w - position.y) * 0.5;
		#endif 



 
		float3 worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;
		fixed3 worldNormal = UnityObjectToWorldNormal(v.normal);
		fixed3 worldTangent = UnityObjectToWorldDir(v.tangent.xyz);
		fixed tangentSign = v.tangent.w * unity_WorldTransformParams.w;
		fixed3 worldBinormal = cross(worldNormal, worldTangent) * tangentSign;
		o.tSpace0 = float4(worldTangent.x, worldBinormal.x, worldNormal.x, worldPos.x);
		o.tSpace1 = float4(worldTangent.y, worldBinormal.y, worldNormal.y, worldPos.y);
		o.tSpace2 = float4(worldTangent.z, worldBinormal.z, worldNormal.z, worldPos.z);
			 
		PURE_TRANSFER_FOG(o,v.vertex);  
		return o; 
	}

  
 
	inline half4 CacuWaterLight(WaterColor s){	
		half3 nNormal = normalize(s.normal);
		half shininess = s.Gloss * 250.0 + 4.0;
		
		s.lightDir = normalize(s.lightDir);

		//half reflectiveFactor = max(0.0, dot(-s.viewDir, reflect(s.lightDir, nNormal)));	// Phong shading model

		// Blinn-Phong shading model
		half reflectiveFactor = max(0.0, dot(nNormal, normalize(s.lightDir + s.viewDir)));
	 
		half diffuseFactor = max(0.0, dot(nNormal, s.lightDir));
		half specularFactor = pow(reflectiveFactor, shininess) * s.Specular;
	 
		half4 c;
		c.rgb = (s.Albedo * diffuseFactor + _Specular.rgb * specularFactor) * _LightColor0.rgb;
		c.rgb *= (s.atten * 2.0);
		c.a = s.Alpha;  
		return c;
	}

	 
 








#endif 